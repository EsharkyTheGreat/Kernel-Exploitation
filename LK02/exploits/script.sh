#/usr/bin/env bash

if [ $# -eq 0 ]; then
    echo "This is a help script for kernel exploitation"
    echo "build_debug"
    echo "buil_chall"
    echo "build_exp"
    echo "run_debug"
    echo "run_chall"
fi

case $1 in
    "compress_debug_fs")
        echo "Building Debug fs"
        cd ../debug/fs
        find . -print0 | cpio -o --null --format=newc --owner root > ../debugfs.cpio     
        ;;
    "create_debug_fs")
        echo "Creating Debug fs"
        cd ../debug
        rm -rf fs
        mkdir -p fs
        cd fs
        cpio -idv < ../debugfs.cpio
        ;;
    "run_debug")
        echo "Running QEMU debug script"
        cd ../debug
        ./debug.sh
        ;;
    "cp_exp_debug")
        echo "Copying Exploit to debugfs"
        gcc $2 -o exploit -static
        cp exploit ../debug/fs/exploit
        ;;
    "compress_chall_fs")
        echo "Compressing Chall fs"
        cd ../chall/fs
        find . -print0 | cpio -o --null --format=newc --owner root > ../rootfs.cpio     
        ;;
    "create_chall_fs")
        echo "Creating Chall fs"
        cd ../chall
        rm -rf fs
        mkdir -p fs
        cd fs
        cpio -idv < ../rootfs.cpio
        ;;
    "run_chall")
        echo "Running QEMU chall script"
        cd ../chall
        ./run.sh
        ;;
    "cp_exp_chall")
        echo "Copying Exploit to rootfs"
        gcc $2 -o exploit -static
        cp exploit ../chall/fs/exploit
        ;;
    *)
        echo "Error"
esac