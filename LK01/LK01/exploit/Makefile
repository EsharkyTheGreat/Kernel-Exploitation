exploit: ret2usr.c
	gcc ret2usr.c -o exploit -static

run: exploit
#clean up
	rm -rf ../qemu/fs
	mkdir -p ../qemu/fs
#copy exploit
	cd ../qemu/fs; cpio -idv < ../rootfs.cpio
	cp exploit ../qemu/fs/exploit
	cd ../qemu/fs; find . -print0 | cpio -o --null --format=newc --owner root > ../rootfs.cpio
#run qemu
	./run.sh

debug: exploit ../qemu/fs
#clean up
	rm -rf ../qemu/fs
	mkdir -p ../qemu/fs
#copy exploit
	cd ../qemu/fs; cpio -idv < ../debugfs.cpio
	cp exploit ../qemu/fs/exploit
	cd ../qemu/fs; find . -print0 | cpio -o --null --format=newc --owner root > ../debugfs.cpio
#run qemu
	./debug.sh